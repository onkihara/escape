{"version":3,"file":"6-db6e1ba3.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/setup/_page.server.js","../../../.svelte-kit/adapter-node/nodes/6.js"],"sourcesContent":["import { r as redirect, f as fail } from \"../../../chunks/index.js\";\nimport { d as db, B as BLIKK_ESCAPE_SECRET } from \"../../../chunks/mysql.js\";\nlet connection = null;\nconst setup = function(data) {\n  connection = db.connect();\n  dropTables();\n  createTables();\n  createDefaults(data);\n  db.close(connection);\n};\nfunction createDefaults(data) {\n  const date = (/* @__PURE__ */ new Date()).toISOString().slice(0, 19).replace(\"T\", \" \");\n  let query = \"INSERT INTO `houses` (`id`, `name`, `hash`, `created_at`, `updated_at`)VALUES (1, 'default', 'default', '\" + date + \"', '\" + date + \"');\";\n  runQuery(query);\n  query = \"INSERT INTO `players` (`id`, `house_id`, `key`, `role`, `rank`, `created_at`, `updated_at`)VALUES (1, 1, '\" + data.root_key + \"', 'root', 0, '\" + date + \"', '\" + date + \"');\";\n  runQuery(query);\n}\nfunction createTables() {\n  let query = \"CREATE TABLE IF NOT EXISTS `houses` (`id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,`name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,`hash` varchar(16) COLLATE utf8mb4_unicode_ci NOT NULL,`created_at` timestamp NULL DEFAULT NULL,`updated_at` timestamp NULL DEFAULT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n  runQuery(query);\n  query = \"CREATE TABLE IF NOT EXISTS `players` (`id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT,`house_id` bigint(20) UNSIGNED NOT NULL,`key` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,`role` varchar(16) COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'user',`rank` int(10) UNSIGNED NOT NULL DEFAULT '0',`created_at` timestamp NULL DEFAULT NULL,`updated_at` timestamp NULL DEFAULT NULL,PRIMARY KEY (`id`)) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n  runQuery(query);\n  query = \"ALTER TABLE `players`ADD UNIQUE KEY `house_id_key_unique` (`house_id`,`key`),ADD KEY `house_id_foreign` (`house_id`);\";\n  runQuery(query);\n  query = \"ALTER TABLE `players`ADD CONSTRAINT `house_id_foreign` FOREIGN KEY (`house_id`) REFERENCES `houses` (`id`) ON DELETE CASCADE;\";\n  runQuery(query);\n}\nfunction dropTables() {\n  connection.query(\"DROP TABLE IF EXISTS `players`;\");\n  connection.query(\"DROP TABLE IF EXISTS `houses`;\");\n}\nfunction runQuery(query) {\n  connection.query(query, (err, results) => {\n    console.log(err);\n    console.log(results);\n  });\n}\nconst actions = {\n  default: async ({ request, cookies }) => {\n    const data = await request.formData();\n    let validation_error = \"\";\n    const formdata = {};\n    for (const key of data.keys()) {\n      formdata[key] = data.get(key);\n    }\n    if (data.get(\"passphrase\") !== BLIKK_ESCAPE_SECRET) {\n      validation_error = \"incorrect passphrase\";\n    } else if (!data.get(\"root_key\")) {\n      validation_error = \"no key for root given\";\n    }\n    if (validation_error === \"\") {\n      setup(formdata);\n      throw redirect(303, \"/\");\n    }\n    return fail(403, {\n      incorrect: true,\n      incorrect_parameter: validation_error,\n      ...formdata\n    });\n  }\n};\nexport {\n  actions\n};\n","import * as server from '../entries/pages/setup/_page.server.js';\n\nexport const index = 6;\nexport const component = async () => (await import('../entries/pages/setup/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/setup/+page.server.js\";\nexport const imports = [\"_app/immutable/entry/setup-page.svelte.012a5a1e.js\",\"_app/immutable/chunks/index.5e7f823c.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}